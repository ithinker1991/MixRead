<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Review - MixRead</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      #review-container {
        width: 100%;
        max-width: 800px;
      }

      /* Review Session Styles */
      .review-session {
        background: white;
        border-radius: 12px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        padding: 30px;
      }

      .review-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        flex-wrap: wrap;
        gap: 20px;
      }

      .progress-section {
        flex: 1;
        min-width: 200px;
      }

      .progress-count {
        display: block;
        font-size: 14px;
        color: #666;
        margin-bottom: 8px;
        font-weight: 500;
      }

      .progress-bar {
        width: 100%;
        height: 8px;
        background: #e0e0e0;
        border-radius: 4px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        transition: width 0.3s ease;
      }

      .review-controls {
        display: flex;
        gap: 10px;
      }

      .btn {
        padding: 10px 16px;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
      }

      .btn-secondary {
        background: #f5f5f5;
        color: #333;
      }

      .btn-secondary:hover {
        background: #e0e0e0;
      }

      .btn-danger {
        background: #f44336;
        color: white;
      }

      .btn-danger:hover {
        background: #d32f2f;
      }

      /* Flashcard Styles */
      .flashcard-container {
        margin-bottom: 30px;
      }

      .flashcard {
        position: relative;
        min-height: 400px;
        perspective: 1000px;
      }

      .card-side {
        width: 100%;
        min-height: 400px;
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 12px;
        padding: 40px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        transition: all 0.3s ease;
        backface-visibility: hidden;
      }

      .card-front {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
      }

      .card-back {
        background: #f5f5f5;
      }

      .card-type-indicator {
        font-size: 12px;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.8);
        margin-bottom: 20px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .card-back .card-type-indicator {
        color: #999;
      }

      .card-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 20px;
      }

      .word-text {
        font-size: 48px;
        font-weight: 600;
        margin: 20px 0;
        line-height: 1.2;
      }

      .card-front .word-text {
        color: white;
      }

      .card-back .word-text {
        color: #333;
      }

      .word-hints {
        font-size: 12px;
        color: rgba(255, 255, 255, 0.7);
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        justify-content: center;
      }

      .word-hints .hint {
        background: rgba(255, 255, 255, 0.1);
        padding: 4px 12px;
        border-radius: 4px;
      }

      .definition {
        font-size: 18px;
        color: #333;
        margin-bottom: 15px;
        line-height: 1.6;
      }

      .example {
        font-size: 14px;
        color: #666;
        background: white;
        padding: 15px;
        border-left: 4px solid #667eea;
        border-radius: 4px;
        line-height: 1.6;
      }

      .cefr {
        font-size: 12px;
        color: #999;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .show-answer-btn {
        margin-top: 20px;
        padding: 12px 24px;
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid white;
        color: white;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .show-answer-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
      }

      /* Review Buttons */
      .review-buttons {
        margin-top: 30px;
      }

      .review-buttons h3 {
        font-size: 14px;
        color: #666;
        margin-bottom: 15px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .button-group {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 12px;
      }

      .review-btn {
        padding: 12px;
        border: 2px solid #e0e0e0;
        background: white;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
      }

      .review-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .review-btn.again {
        border-color: #f44336;
        color: #f44336;
      }

      .review-btn.again:active {
        background: #f44336;
        color: white;
      }

      .review-btn.hard {
        border-color: #ff9800;
        color: #ff9800;
      }

      .review-btn.hard:active {
        background: #ff9800;
        color: white;
      }

      .review-btn.good {
        border-color: #2196f3;
        color: #2196f3;
      }

      .review-btn.good:active {
        background: #2196f3;
        color: white;
      }

      .review-btn.easy {
        border-color: #4caf50;
        color: #4caf50;
      }

      .review-btn.easy:active {
        background: #4caf50;
        color: white;
      }

      .review-btn.known {
        border-color: #9c27b0;
        color: #9c27b0;
      }

      .review-btn.known:active {
        background: #9c27b0;
        color: white;
      }

      .btn-label {
        font-weight: 600;
        font-size: 14px;
      }

      .btn-hint {
        font-size: 11px;
        opacity: 0.7;
      }

      /* Session Stats */
      .session-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 15px;
        margin-top: 30px;
        padding-top: 30px;
        border-top: 1px solid #e0e0e0;
      }

      .stat {
        text-align: center;
      }

      .stat-label {
        display: block;
        font-size: 12px;
        color: #999;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 8px;
      }

      .stat-value {
        display: block;
        font-size: 24px;
        font-weight: 600;
        color: #333;
      }

      /* Session Selector */
      .session-selector {
        text-align: center;
        padding: 40px;
      }

      .session-selector h2 {
        margin-bottom: 30px;
        color: #333;
      }

      .session-selector .btn {
        display: block;
        width: 100%;
        margin-bottom: 15px;
        padding: 16px;
        font-size: 16px;
      }

      /* Completion Screen */
      .completion-screen {
        text-align: center;
        padding: 40px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 12px;
        color: white;
      }

      .completion-screen h2 {
        font-size: 36px;
        margin-bottom: 30px;
      }

      .summary-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .summary-stats .stat {
        background: rgba(255, 255, 255, 0.1);
        padding: 20px;
        border-radius: 8px;
      }

      .summary-stats .stat-label {
        color: rgba(255, 255, 255, 0.8);
      }

      .summary-stats .stat-value {
        color: white;
      }

      .actions {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
      }

      .actions .btn {
        flex: 1;
        min-width: 150px;
      }

      /* Error Message */
      .error-message {
        background: #f44336;
        color: white;
        padding: 16px;
        border-radius: 4px;
        margin-bottom: 20px;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .review-session {
          padding: 20px;
        }

        .word-text {
          font-size: 32px;
        }

        .card-side {
          min-height: 300px;
          padding: 20px;
        }

        .button-group {
          grid-template-columns: 1fr 1fr;
        }

        .review-controls {
          width: 100%;
          order: 3;
        }

        .review-controls .btn {
          flex: 1;
        }
      }

      @media (max-width: 480px) {
        body {
          padding: 10px;
        }

        .review-session {
          padding: 15px;
        }

        .word-text {
          font-size: 24px;
        }

        .definition {
          font-size: 14px;
        }

        .example {
          font-size: 12px;
          padding: 10px;
        }

        .button-group {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div id="review-container">
      <!-- Initial session selector will be rendered here -->
      <div class="session-selector">
        <h2>üìö Choose Review Type</h2>
        <button id="mixed-btn" class="btn btn-primary">
          <span style="font-size: 16px; margin-bottom: 8px">üîÄ</span>
          Mixed (New + Due)
        </button>
        <button id="new-btn" class="btn btn-secondary">
          <span style="font-size: 16px; margin-bottom: 8px">‚ú®</span>
          New Words Only
        </button>
        <button id="review-btn" class="btn btn-secondary">
          <span style="font-size: 16px; margin-bottom: 8px">üîÑ</span>
          Review Due Words
        </button>
      </div>
    </div>

    <!-- Review session template (hidden, used via JS) -->
    <template id="review-session-template">
      <div class="review-session">
        <!-- Progress Bar -->
        <div class="review-header">
          <div class="progress-section">
            <span class="progress-count">
              <span id="current-card">1</span> /
              <span id="total-cards">20</span>
            </span>
            <div class="progress-bar">
              <div class="progress-fill" id="progress-fill"></div>
            </div>
          </div>
          <div class="review-controls">
            <button id="pause-btn" class="btn btn-secondary">Pause</button>
            <button id="quit-btn" class="btn btn-danger">Quit</button>
          </div>
        </div>

        <!-- Flashcard Container -->
        <div class="flashcard-container">
          <div class="flashcard" id="flashcard">
            <!-- Card Front -->
            <div class="card-side card-front" id="card-front">
              <div class="card-type-indicator" id="card-type">
                Word ‚Üí Definition
              </div>
              <div class="card-content" id="card-front-content">
                <div class="word-text" id="word-text">serendipity</div>
                <div class="word-hints" id="card-hints" style="display: none">
                  <span class="hint" id="cefr">CEFR: C1</span>
                </div>
              </div>
              <button class="show-answer-btn" id="show-answer-btn">
                Show Answer <kbd>Space</kbd>
              </button>
            </div>

            <!-- Card Back -->
            <div
              class="card-side card-back"
              id="card-back"
              style="display: none"
            >
              <div class="card-content">
                <div class="word-text" id="back-word">serendipity</div>
                <div class="definition" id="definition">
                  The occurrence of events by chance in a happy way
                </div>
                <div class="example" id="example">
                  <strong>Example:</strong> A fortunate stroke of serendipity
                  brought the two friends together.
                </div>
              </div>

              <!-- Review Buttons -->
              <div class="review-buttons">
                <h3>How well did you know this?</h3>
                <div class="button-group">
                  <button class="review-btn again" data-quality="0">
                    <span class="btn-label">Again</span>
                    <span class="btn-hint">(< 1 day)</span>
                  </button>
                  <button class="review-btn hard" data-quality="1">
                    <span class="btn-label">Hard</span>
                    <span class="btn-hint">(3 days)</span>
                  </button>
                  <button class="review-btn good" data-quality="3">
                    <span class="btn-label">Good</span>
                    <span class="btn-hint">(1 week)</span>
                  </button>
                  <button class="review-btn easy" data-quality="5">
                    <span class="btn-label">Easy</span>
                    <span class="btn-hint">(2 weeks)</span>
                  </button>
                  <button class="review-btn known" id="btn-already-known">
                    <span class="btn-label">‚úì Â∑≤ÊéåÊè°</span>
                    <span class="btn-hint">(‰∏çÂÜçÂ§ç‰π†)</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Session Stats -->
        <div class="session-stats" id="session-stats">
          <div class="stat">
            <span class="stat-label">Correct</span>
            <span class="stat-value" id="correct-count">0</span>
          </div>
          <div class="stat">
            <span class="stat-label">Streak</span>
            <span class="stat-value" id="streak-count">0</span>
          </div>
          <div class="stat">
            <span class="stat-label">Accuracy</span>
            <span class="stat-value" id="accuracy">--</span>
          </div>
          <div class="stat">
            <span class="stat-label">Time</span>
            <span class="stat-value" id="time-elapsed">0:00</span>
          </div>
        </div>
      </div>
    </template>

    <script src="../modules/review/review-manager.js?v=20241204-2"></script>
    <script>
      // Initialize review manager
      const userId =
        new URLSearchParams(window.location.search).get("user_id") ||
        "test_user";
      const reviewManager = new ReviewManager(userId);

      // Session selector buttons
      document.getElementById("mixed-btn")?.addEventListener("click", () => {
        startReviewSession("mixed");
      });

      document.getElementById("new-btn")?.addEventListener("click", () => {
        startReviewSession("new");
      });

      document.getElementById("review-btn")?.addEventListener("click", () => {
        startReviewSession("review");
      });

      async function startReviewSession(sessionType) {
        try {
          // Load template
          const template = document.getElementById("review-session-template");
          const container = document.getElementById("review-container");

          container.innerHTML = "";
          container.appendChild(template.content.cloneNode(true));

          // Start session
          await reviewManager.startSession(sessionType);
        } catch (error) {
          console.error("Failed to start review:", error);
          reviewManager.showError("Failed to start review session");
        }
      }

      // Keyboard shortcut info
      console.log(`
    ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
    ‚ïë   MixRead Review Shortcuts      ‚ïë
    ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
    ‚ïë  Space - Show answer            ‚ïë
    ‚ïë  1     - Again (< 1 day)        ‚ïë
    ‚ïë  2     - Hard (3 days)          ‚ïë
    ‚ïë  3     - Good (1 week)          ‚ïë
    ‚ïë  4     - Easy (2 weeks)         ‚ïë
    ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
        `);
    </script>
  </body>
</html>
