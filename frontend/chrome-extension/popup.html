<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MixRead</title>
    <link rel="stylesheet" href="popup.css" />
  </head>
  <body>
    <div class="popup-container">
      <div class="popup-header">
        <h1>MixRead</h1>
        <p class="subtitle">Learn English through reading</p>
        <div class="user-info">
          <div
            style="
              display: flex;
              align-items: center;
              gap: 5px;
              margin-bottom: 5px;
            "
          >
            <small style="color: #666; font-size: 10px">User:</small>
            <select
              id="user-selector"
              style="
                font-size: 10px;
                padding: 2px 4px;
                border: 1px solid #ddd;
                border-radius: 3px;
              "
            >
              <option value="">-- Select User --</option>
            </select>
            <button
              id="add-new-user"
              style="
                font-size: 10px;
                padding: 2px 6px;
                background: #007bff;
                color: white;
                border: none;
                border-radius: 3px;
                cursor: pointer;
              "
            >
              + New
            </button>
          </div>
          <small style="color: #666; font-size: 10px"
            >Current:
            <code
              id="user-id-display"
              style="background: #f0f0f0; padding: 2px 4px; border-radius: 3px"
              >Loading...</code
            ></small
          >
        </div>
      </div>

      <!-- Tab Navigation -->
      <div class="popup-tabs">
        <button class="tab-btn active" data-tab="main-tab">Settings</button>
        <button class="tab-btn" data-tab="domain-tab">Domains</button>
      </div>

      <!-- Main Tab Content -->
      <div id="main-tab" class="tab-content active">
        <div class="popup-section">
          <label for="difficulty-slider" class="slider-label"
            >Your English Level</label
          >
          <div class="difficulty-labels">
            <span class="label-easy">A1 (Beginner)</span>
            <span class="label-hard">C2 (Mastery)</span>
          </div>
          <input
            type="range"
            id="difficulty-slider"
            min="1"
            max="6"
            value="3"
            step="1"
          />
          <div class="difficulty-display">
            <span id="current-level">B1</span>
          </div>
          <div class="difficulty-explanation">
            <p id="level-description" class="level-description">
              Highlights <strong>B1-C2</strong> words - Intermediate level, good
              for improving reading ability
            </p>
          </div>
        </div>

        <div class="popup-section">
          <div class="toggle-setting">
            <label for="toggle-chinese" class="toggle-label">
              <span>æ˜¾ç¤ºä¸­æ–‡é‡Šä¹‰ Show Chinese</span>
              <input type="checkbox" id="toggle-chinese" checked />
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <div class="popup-section">
          <button id="btn-start-review" class="btn btn-primary" style="background: #28a745; margin-bottom: 8px;">
            â–¶ Start Review Session
          </button>
        </div>

        <div class="popup-section">
          <button id="btn-toggle-sidebar" class="btn btn-primary">
            ğŸ“‹ Toggle Sidebar
          </button>
          <button id="btn-view-library" class="btn btn-primary">
            ğŸ“š My Library (<span id="library-count">0</span>)
          </button>
          <button id="btn-view-vocabulary" class="btn btn-secondary">
            View Vocabulary (<span id="vocab-count">0</span>)
          </button>
          <button id="btn-reset-vocab" class="btn btn-secondary">
            Clear All
          </button>
        </div>

        <div class="popup-section">
          <div class="stats">
            <div class="stat-item">
              <span class="stat-label">ğŸ“š Today</span>
              <span class="stat-value" id="today-count">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">ğŸ“ˆ This Week</span>
              <span class="stat-value" id="week-count">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">ğŸ’¡ Total</span>
              <span class="stat-value" id="total-count">0</span>
            </div>
          </div>
        </div>

        <div class="popup-section">
          <div class="reading-stats">
            <div class="reading-stat-item">
              <span class="reading-stat-label"
                >â±ï¸ Reading Time (This Week)</span
              >
              <span class="reading-stat-value" id="reading-time">0m</span>
            </div>
          </div>
        </div>

        <div class="popup-section">
          <p class="help-text">
            ğŸ“– Hover over
            <span class="highlight-demo">highlighted words</span> to see
            definitions.
            <br />
            ğŸšï¸ Adjust difficulty to show more or fewer words.
          </p>
        </div>
      </div>
      <!-- End main-tab -->

      <!-- Domain Management Tab Content -->
      <div id="domain-tab" class="tab-content">
        <div class="popup-section">
          <h3 style="margin: 0 0 10px 0; font-size: 14px">Domain Blacklist</h3>
          <p style="margin: 0 0 10px 0; font-size: 12px; color: #666">
            Disable highlighting on specific websites to reduce distractions.
          </p>
        </div>

        <!-- Quick Actions Section (NEW) -->
        <div class="popup-section" style="background: #f0f8ff; border: 1px solid #b3d9ff; border-radius: 4px; padding: 10px">
          <h4 style="margin: 0 0 8px 0; font-size: 12px; color: #0066cc; font-weight: bold">
            âš¡ Quick Actions
          </h4>
          <div id="quick-action-status" style="display: none; padding: 6px; border-radius: 3px; margin-bottom: 8px; font-size: 11px; background: #fff; border: 1px solid #ddd"></div>
          <p style="margin: 0 0 8px 0; font-size: 11px; color: #666">
            Current Page: <strong id="current-page-domain" style="color: #0066cc">loading...</strong>
          </p>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px">
            <button
              id="btn-quick-exclude-domain"
              style="
                padding: 6px 8px;
                background: #dc3545;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-size: 11px;
                font-weight: bold;
              "
            >
              ğŸš« Exclude Domain
            </button>
            <button
              id="btn-quick-exclude-path"
              style="
                padding: 6px 8px;
                background: #fd7e14;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-size: 11px;
                font-weight: bold;
              "
            >
              ğŸš« Exclude Path
            </button>
          </div>
          <p style="margin: 8px 0 0 0; font-size: 10px; color: #666">
            ğŸ’¡ Tip: Page will refresh after adding to blacklist
          </p>
        </div>

        <div class="popup-section">
          <div style="display: flex; gap: 5px; margin-bottom: 10px">
            <input
              type="text"
              id="domain-input"
              placeholder="example.com"
              style="
                flex: 1;
                padding: 6px 8px;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-size: 12px;
              "
            />
            <button
              id="btn-add-domain"
              style="
                padding: 6px 12px;
                background: #28a745;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-size: 12px;
              "
            >
              Add
            </button>
          </div>
        </div>

        <div class="popup-section">
          <h4 style="margin: 0 0 8px 0; font-size: 12px; color: #333">
            Blacklist (<span id="blacklist-count">0</span>)
          </h4>
          <div
            id="blacklist-container"
            style="
              max-height: 150px;
              overflow-y: auto;
              border: 1px solid #eee;
              border-radius: 4px;
              padding: 8px;
            "
          >
            <p
              id="empty-blacklist-msg"
              style="margin: 0; color: #999; font-size: 12px"
            >
              No domains in blacklist
            </p>
            <ul
              id="blacklist-items"
              style="margin: 0; padding: 0; list-style: none"
            ></ul>
          </div>
        </div>

        <div class="popup-section">
          <button
            id="btn-preset-domains"
            style="
              width: 100%;
              padding: 8px;
              background: #f8f9fa;
              color: #333;
              border: 1px solid #ddd;
              border-radius: 4px;
              cursor: pointer;
              font-size: 12px;
            "
          >
            Add Preset Domains
          </button>
        </div>
      </div>
      <!-- End domain-tab -->
    </div>

    <script src="shared/api-client.js"></script>
    <script src="shared/navigation.js"></script>
    <script src="content/scripts/logger.js"></script>
    <script src="content/modules/domain-policy/domain-policy-store.js"></script>
    <script src="content/modules/domain-policy/domain-policy-filter.js"></script>
    <script src="content/modules/domain-policy/preset-dialog.js"></script>
    <link rel="stylesheet" href="content/modules/domain-policy/preset-dialog.css" />
    <script src="popup.js"></script>
  </body>
</html>
